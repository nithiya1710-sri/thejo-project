<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTDR UI</title>
    <link rel="icon" href="https://media.licdn.com/dms/image/v2/C510BAQE0Bl7hf7aScw/company-logo_200_200/company-logo_200_200/0/1630600313094?e=2147483647&v=beta&t=FZ8EuFLC6bjx0ri55MlDLMQKr-rrqm0hhXqXo1mHjt0" type="image/x-icon"¬†/>
    <link rel="stylesheet" href="/expert.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
   
   
</head>
<body>
    <div class="container">
        <div class="graph-area">
            
            <p id="autoTestText">Auto Test <span id="wavelength">1550</span>nm <span id="distance">500</span>m <span id="pulse">30</span>ns</p>

            <div class="graph-container">
                <canvas id="otdrGraph"></canvas>
            </div>
        </div>
        <div class="side-menu">
            <button class="menu-btn">Settings</button>
            <button class="menu-btn">Cursor A</button>
            <button class="menu-btn">Zoom</button>
            <button class="menu-btn">Files</button>
            <button class="menu-btn">Save</button>
            <button class="menu-btn" onclick="window.location.href='home.html'">Exit</button>
        </div>
        <div class="controls">
            <div class="buttons">
                <i class='bx bxs-left-arrow arrow-btn' data-target="wavelength" data-direction="-1"></i>
<button><span id="wavelength">1550</span>nm</button>
<i class='bx bxs-right-arrow arrow-btn' data-target="wavelength" data-direction="1"></i>

<i class='bx bxs-left-arrow arrow-btn' data-target="distance" data-direction="-1"></i>
<button><span id="distance">500</span>m</button>
<i class='bx bxs-right-arrow arrow-btn' data-target="distance" data-direction="1"></i>

<i class='bx bxs-left-arrow arrow-btn' data-target="pulse" data-direction="-1"></i>
<button><span id="pulse">30</span>ns</button>
<i class='bx bxs-right-arrow arrow-btn' data-target="pulse" data-direction="1"></i>

<i class='bx bxs-left-arrow arrow-btn' data-target="time" data-direction="-1"></i>
<button><span id="time">15</span>s</button>
<i class='bx bxs-right-arrow arrow-btn' data-target="time" data-direction="1"></i>

            </div>
            
            <div class="test-buttons">
                <button class="real-test">Real Test</button>
                <button class="avg-test">Avg. Test</button>
                <button class="auto-test">Auto Test</button>
            </div>
        </div>
        <div class="bottom-nav">
            <button><i class='bx bx-line-chart'></i></i>Curve</button>
            <button><i class='bx bx-list-ul'></i>List</button>
            <button><i class='bx bx-calendar-event'></i>EventMap</button>
            <button><i class='bx bx-save'></i>FastSave</button>
            <button><i class='bx bx-cog'></i>Settings</button>
        </div>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // üî• 1Ô∏è‚É£ Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBLric_hMRLUDD7TxdIcPtmavCLnmQmfsE",
            authDomain: "thejo-otdr.firebaseapp.com",
            databaseURL: "https://thejo-otdr-default-rtdb.firebaseio.com",  // ‚úÖ Added Database URL
            projectId: "thejo-otdr",
            storageBucket: "thejo-otdr.firebasestorage.app",
            messagingSenderId: "255389594468",
            appId: "1:255389594468:web:e1929f090a828af0504071"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        

        const values = {
    wavelength: [1310, 1550],
    distance: [500, 1000, 2000, 4000, 8000, 16000, 32000, 64000, 100000], // in meters
    pulse: [3, 5, 10, 20, 30, 50, 80, 160],
    time: [5, 15, 30, 60, 120, 180]
};

function updateValue(id, direction) {
    let element = document.getElementById(id);
    let currentValue = parseFloat(element.innerText);  // ‚úÖ Use parseFloat for safety
    let options = values[id];

    let currentIndex = options.indexOf(currentValue);
    if (currentIndex === -1) return;

    let newIndex = currentIndex + (direction > 0 ? 1 : -1);

    if (newIndex >= 0 && newIndex < options.length) {
        element.innerText = options[newIndex];  // ‚úÖ Correctly updates the UI
        updateAutoTestText();
    }
}

function updateAutoTestText() {
    let wavelength = document.getElementById("wavelength").innerText;
    let distance = document.getElementById("distance").innerText;
    let pulse = document.getElementById("pulse").innerText;
    let time = document.getElementById("time").innerText;

    document.getElementById("autoTestText").innerText =
        `Auto Test ${wavelength}nm ${distance}m ${pulse}ns ${time}s`;
}

// ‚úÖ Use dataset attributes instead of onclick parsing
document.querySelectorAll(".arrow-btn").forEach(button => {
    button.addEventListener("click", function () {
        let targetId = this.dataset.target; // Use data-target instead of parsing onclick
        let direction = this.dataset.direction === "1" ? 1 : -1;
        updateValue(targetId, direction);
    });
});


        // üéØ 2Ô∏è‚É£ Fetch Data from Firebase
        async function fetchGraphData() {
            try {
                const snapshot = await get(ref(database, 'otdr_data'));
                const data = snapshot.val();

                if (!data) {
                    console.error("No data found!");
                    return;
                }

                let graphData = [];

                for (let key in data) {
                    graphData.push({
                        x: data[key].distance_km,
                        y: data[key].signal_loss_db
                    });
                }

                console.log("Fetched Data:", graphData); // üîç Debugging Log

                plotGraph(graphData);
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        // üìä 3Ô∏è‚É£ Plot Graph using Chart.js
        function plotGraph(graphData) {
            const ctx = document.getElementById('otdrGraph').getContext('2d');

            new Chart(ctx, {
                type: 'line', // ‚úÖ Changed from scatter to line for better visibility
                data: {
                    labels: graphData.map(point => point.x), // X-axis values (Distance)
                    datasets: [{
                        label: 'Signal Loss (dB)',
                        data: graphData.map(point => point.y), // Y-axis values (Signal Loss)
                        borderColor: 'white',
                        backgroundColor: 'rgba(255, 0, 0, 0.2)',
                        borderWidth: 2,
                        pointRadius: 3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: true },
                        tooltip: { enabled: true }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Distance (km)' } },
                        y: { title: { display: true, text: 'Signal Loss (dB)' } }
                    }
                }
            });
        }

        // üöÄ 4Ô∏è‚É£ Fetch Data and Plot Graph on Load
        window.onload = fetchGraphData;
        
    </script>
    <script src="system.js"></script>
    <script>
    // üîÜ Brightness Control
const brightnessMap = {
  "0%": 0,
  "20%": 0.2,
  "40%": 0.4,
  "60%": 0.6,
  "80%": 0.8,
  "100%": 1
};
const savedBrightness = localStorage.getItem("brightness") || "100%";
document.body.style.filter = `brightness(${brightnessMap[savedBrightness] || 1})`;

// üåç Language Translations
const lang = localStorage.getItem("language") || "en";
const uiText = {
  en: {
    autoTest: "Auto Test",
    realTest: "Real Test",
    avgTest: "Avg. Test",
    settings: "Settings",
    cursor: "Cursor A",
    zoom: "Zoom",
    files: "Files",
    save: "Save",
    exit: "Exit",
    curve: "Curve",
    list: "List",
    eventMap: "EventMap",
    fastSave: "FastSave"
  },
  fr: {
    autoTest: "Test auto",
    realTest: "Test r√©el",
    avgTest: "Test moy.",
    settings: "Param√®tres",
    cursor: "Curseur A",
    zoom: "Zoom",
    files: "Fichiers",
    save: "Enregistrer",
    exit: "Quitter",
    curve: "Courbe",
    list: "Liste",
    eventMap: "Carte d‚Äô√©v√©nement",
    fastSave: "Sauvegarde rapide"
  },
  es: {
    autoTest: "Prueba autom√°tica",
    realTest: "Prueba real",
    avgTest: "Prueba prom.",
    settings: "Configuraciones",
    cursor: "Cursor A",
    zoom: "Zoom",
    files: "Archivos",
    save: "Guardar",
    exit: "Salir",
    curve: "Curva",
    list: "Lista",
    eventMap: "Mapa de eventos",
    fastSave: "Guardar r√°pido"
  },
  nl: {
    autoTest: "Automatische test",
    realTest: "Re√´le test",
    avgTest: "Gem. test",
    settings: "Instellingen",
    cursor: "Cursor A",
    zoom: "Zoom",
    files: "Bestanden",
    save: "Opslaan",
    exit: "Afsluiten",
    curve: "Curve",
    list: "Lijst",
    eventMap: "Gebeurteniskaart",
    fastSave: "Snel opslaan"
  },
  de: {
    autoTest: "Automatischer Test",
    realTest: "Realer Test",
    avgTest: "Durchschn. Test",
    settings: "Einstellungen",
    cursor: "Cursor A",
    zoom: "Zoom",
    files: "Dateien",
    save: "Speichern",
    exit: "Beenden",
    curve: "Kurve",
    list: "Liste",
    eventMap: "Ereigniskarte",
    fastSave: "Schnellspeichern"
  },
  it: {
    autoTest: "Test automatico",
    realTest: "Test reale",
    avgTest: "Test medio",
    settings: "Impostazioni",
    cursor: "Cursore A",
    zoom: "Zoom",
    files: "File",
    save: "Salva",
    exit: "Esci",
    curve: "Curva",
    list: "Elenco",
    eventMap: "Mappa eventi",
    fastSave: "Salvataggio veloce"
  },
  pt: {
    autoTest: "Teste autom√°tico",
    realTest: "Teste real",
    avgTest: "Teste m√©d.",
    settings: "Configura√ß√µes",
    cursor: "Cursor A",
    zoom: "Zoom",
    files: "Arquivos",
    save: "Salvar",
    exit: "Sair",
    curve: "Curva",
    list: "Lista",
    eventMap: "Mapa de eventos",
    fastSave: "Salvar r√°pido"
  }
};

const t = uiText[lang] || uiText.en;

// üñº Apply UI Labels
function applyOTDRLabels() {
  // Test buttons
  document.querySelector(".auto-test").innerText = t.autoTest;
  document.querySelector(".real-test").innerText = t.realTest;
  document.querySelector(".avg-test").innerText = t.avgTest;

  // Side menu buttons
  const menuBtns = document.querySelectorAll(".side-menu .menu-btn");
  if (menuBtns.length >= 6) {
    menuBtns[0].innerText = t.settings;
    menuBtns[1].innerText = t.cursor;
    menuBtns[2].innerText = t.zoom;
    menuBtns[3].innerText = t.files;
    menuBtns[4].innerText = t.save;
    menuBtns[5].innerText = t.exit;
  }

  // Bottom nav
  const navBtns = document.querySelectorAll(".bottom-nav button");
  if (navBtns.length >= 5) {
    navBtns[0].innerHTML = `<i class='bx bx-line-chart'></i>${t.curve}`;
    navBtns[1].innerHTML = `<i class='bx bx-list-ul'></i>${t.list}`;
    navBtns[2].innerHTML = `<i class='bx bx-calendar-event'></i>${t.eventMap}`;
    navBtns[3].innerHTML = `<i class='bx bx-save'></i>${t.fastSave}`;
    navBtns[4].innerHTML = `<i class='bx bx-cog'></i>${t.settings}`;
  }
}

// ‚è± Apply on load
document.addEventListener("DOMContentLoaded", applyOTDRLabels);
</script>

</body>
</html>
